<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitMeal - AI 식단 관리</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="text-center bg-white p-10 rounded-lg shadow-lg max-w-lg mx-auto">
        <h1 class="text-4xl font-bold text-teal-500 mb-4">FitMeal</h1>
        <p class="text-xl text-gray-700 mb-6">
            AI 식단 관리 앱 '피트밀'이<br>
            현재 **내부 테스트**를 진행하고 있습니다.
        </p>
        <p class="text-gray-600">
            더욱 완벽한 모습으로 찾아뵙기 위해 준비 중이니, 조금만 기다려주세요!
        </p>
        <div class="mt-8">
            <p id="form-title" class="text-sm text-gray-500">정식 출시 소식을 가장 먼저 받아보시겠어요?</p>
            <form id="subscribe-form" class="mt-2 flex justify-center">
                <input id="email-input" type="email" placeholder="your-email@example.com" class="p-2 border rounded-l-md w-64 focus:outline-none focus:ring-2 focus:ring-teal-500" required>
                <button id="submit-button" type="submit" class="bg-teal-500 text-white px-4 rounded-r-md hover:bg-teal-600 transition">알림받기</button>
            </form>
            <p id="success-message" class="hidden mt-4 text-green-600 font-semibold">감사합니다! 출시 소식을 보내드릴게요.</p>
        </div>
    </div>

    <!-- Firebase SDK 스크립트 -->
    <script type="module">
        // Firebase SDK 임포트
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // '피트밀' 앱과 동일한 Firebase 프로젝트 설정 값
        const firebaseConfig = {
            apiKey: "AIzaSyCRax6rd1rlBIc3kVgg5OkHmSIQyzJmC8A",
            authDomain: "fitmeal-app-d1a97.firebaseapp.com",
            projectId: "fitmeal-app-d1a97",
            storageBucket: "fitmeal-app-d1a97.appspot.com",
            messagingSenderId: "968711774677",
            appId: "1:968711774677:web:b3d3cb9ccc2388c3ba5d5c"
        };

        // Firebase 앱 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 폼 제출 이벤트 처리
        const subscribeForm = document.getElementById('subscribe-form');
        subscribeForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // 폼의 기본 동작(새로고침) 방지

            const emailInput = document.getElementById('email-input');
            const submitButton = document.getElementById('submit-button');
            const email = emailInput.value;

            // 버튼을 '저장 중...'으로 변경하여 중복 클릭 방지
            submitButton.disabled = true;
            submitButton.textContent = '저장 중...';

            try {
                // 'subscribers' 컬렉션에 이메일과 등록 시간을 저장
                await addDoc(collection(db, "subscribers"), {
                    email: email,
                    registeredAt: serverTimestamp() // 서버의 현재 시간을 기록
                });

                // 성공 메시지 표시
                document.getElementById('form-title').classList.add('hidden');
                subscribeForm.classList.add('hidden');
                document.getElementById('success-message').classList.remove('hidden');

            } catch (error) {
                console.error("Error adding document: ", error);
                alert("오류가 발생했습니다. 다시 시도해주세요.");
                // 오류 발생 시 버튼을 다시 활성화
                submitButton.disabled = false;
                submitButton.textContent = '알림받기';
            }
        });
    </script>
</body>
</html>
